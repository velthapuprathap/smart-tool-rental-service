<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ToolEase - Smart Tool Rental Platform</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- Landing Section -->
    <div class="landing-page" id="landingPage">
        <div class="hero-section">
            <div class="container">
                <div class="hero-content">
                    <div class="logo-large">
                        <img src="{{ url_for('static', filename='images/ToolEaseLogo.jpg') }}" alt="ToolEase" class="main-logo">
                        <h1 class="company-name">ToolEase</h1>
                    </div>
                    <p class="tagline">Smart Tool Rental Management with Real-time IoT Monitoring</p>
                    
                    <style>
                    .logo-large {
                        display: flex;
                        align-items: center;
                        gap: 20px;
                        margin-bottom: 25px;
                    }
                    
                    .main-logo {
                        width: 120px;
                        height: 120px;
                        border-radius: 20px;
                        object-fit: contain;
                        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
                        transition: transform 0.3s ease;
                    }
                    
                    .main-logo:hover {
                        transform: scale(1.05);
                    }
                    
                    .company-name {
                        font-family: 'Poppins', sans-serif;
                        font-size: 4.5rem;
                        font-weight: 800;
                        background: linear-gradient(135deg, #00c6ff, #0072ff);
                        background-clip: text;
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        color: transparent;
                        text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.1);
                        margin: 0;
                        letter-spacing: -1px;
                    }
                    </style>
                    <p class="description">
                        Rent tools easily, track them in real-time, and manage your rental business efficiently.
                    </p>
                    <button class="btn-primary btn-large" onclick="showAuth()">Get Started</button>
                </div>
                
                <div class="features-grid">
                    <div class="feature-card">
                        <span class="feature-icon">üè≠</span>
                        <h3>For Owners</h3>
                        <p>List your tools, monitor status, track revenue, and manage rentals</p>
                    </div>
                    <div class="feature-card">
                        <span class="feature-icon">üë∑</span>
                        <h3>For Renters</h3>
                        <p>Find nearby tools, book instantly, track operators, and rate your experience</p>
                    </div>
                    <div class="feature-card">
                        <span class="feature-icon">üöó</span>
                        <h3>For Operators</h3>
                        <p>Accept assignments, navigate to locations, and earn money</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div class="modal" id="authModal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeAuth()">&times;</span>
            
            <!-- Role Selection -->
            <div id="roleSelection" class="auth-step active">
                <h2>Select Your Role</h2>
                <p class="subtitle">Choose how you want to use ToolEase</p>
                
                <div class="role-cards">
                    <div class="role-card" onclick="selectRole('owner')">
                        <span class="role-icon">üè≠</span>
                        <h3>Tool Owner</h3>
                        <p>I want to rent out my tools</p>
                    </div>
                    <div class="role-card" onclick="selectRole('renter')">
                        <span class="role-icon">üë∑</span>
                        <h3>Renter</h3>
                        <p>I need to rent tools</p>
                    </div>
                    <div class="role-card" onclick="selectRole('operator')">
                        <span class="role-icon">üöó</span>
                        <h3>Operator</h3>
                        <p>I want to operate tools for renters</p>
                    </div>
                </div>
            </div>

            <!-- Signup Form -->
            <div id="signupForm" class="auth-step">
                <button class="back-btn" onclick="backToRoles()">‚Üê Back</button>
                <h2>Create Account</h2>
                <p class="subtitle">Sign up as <span id="selectedRole"></span></p>
                
                <form id="signupFormElement" onsubmit="handleSignup(event)">
                    <div class="form-group">
                        <label>Full Name *</label>
                        <input type="text" name="name" required placeholder="Enter your name" minlength="2">
                    </div>
                    
                    <div class="form-group">
                        <label>Email *</label>
                        <input type="email" name="email" required placeholder="your@email.com">
                    </div>
                    
                    <div class="form-group">
                        <label>Phone Number *</label>
                        <input type="tel" name="phone" required placeholder="+91 XXXXX XXXXX" pattern="[0-9+\s-]{10,15}">
                    </div>
                    
                    <div class="form-group">
                        <label>Password *</label>
                        <input type="password" name="password" id="signupPassword" required placeholder="Create a strong password" minlength="6">
                        <small style="color: var(--text-secondary); font-size: 12px;">Minimum 6 characters</small>
                    </div>
                    
                    <div class="form-group">
                        <label>Confirm Password *</label>
                        <input type="password" name="confirm_password" id="confirmPassword" required placeholder="Confirm your password" minlength="6">
                    </div>
                    
                    <div id="ownerFields" style="display: none;">
                        <div class="form-group">
                            <label>Business Type *</label>
                            <select name="business_type">
                                <option value="construction">Construction</option>
                                <option value="manufacturing">Manufacturing</option>
                                <option value="automotive">Automotive</option>
                                <option value="woodworking">Woodworking</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Address</label>
                        <textarea name="address" rows="2" placeholder="Your address"></textarea>
                    </div>
                    
                    <div class="form-group checkbox-group">
                        <label>
                            <input type="checkbox" required>
                            I agree to the Terms & Conditions
                        </label>
                    </div>
                    
                    <button type="submit" class="btn-primary btn-block">Create Account</button>
                </form>
                
                <p class="auth-toggle">
                    Already have an account? <a href="#" onclick="showLogin(); return false;">Login</a>
                </p>
            </div>

            <!-- Login Form -->
            <div id="loginForm" class="auth-step">
                <button class="back-btn" onclick="backToRoles()">‚Üê Back</button>
                <h2>Welcome Back</h2>
                <p class="subtitle">Login as <span id="loginRole"></span></p>
                
                <form id="loginFormElement" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label>Email *</label>
                        <input type="email" name="email" required placeholder="Enter your email">
                    </div>
                    
                    <div class="form-group">
                        <label>Password *</label>
                        <input type="password" name="password" required placeholder="Enter your password">
                    </div>
                    
                    <div class="form-group" style="text-align: right;">
                        <a href="#" style="color: var(--primary-color); font-size: 14px; text-decoration: none;">Forgot Password?</a>
                    </div>
                    
                    <button type="submit" class="btn-primary btn-block">Login</button>
                </form>
                
                <p class="auth-toggle">
                    Don't have an account? <a href="#" onclick="showSignup(); return false;">Sign Up</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="loading-spinner">
        <div class="spinner"></div>
        <p>Loading...</p>
    </div>

    <script>
        let currentRole = '';
        
        // Check if user is already logged in on page load
        window.addEventListener('DOMContentLoaded', function() {
            checkSession();
        });
        
        async function checkSession() {
            try {
                const response = await fetch('/check-session');
                const result = await response.json();
                
                if (result.authenticated) {
                    // User is logged in, redirect to their dashboard
                    redirectToDashboard(result.user.role);
                }
            } catch (error) {
                console.log('No active session');
            }
        }
        
        function showAuth() {
            document.getElementById('authModal').style.display = 'flex';
        }
        
        function closeAuth() {
            document.getElementById('authModal').style.display = 'none';
            resetAuth();
        }
        
        function resetAuth() {
            document.querySelectorAll('.auth-step').forEach(step => step.classList.remove('active'));
            document.getElementById('roleSelection').classList.add('active');
            currentRole = '';
            document.querySelectorAll('form').forEach(form => form.reset());
        }
        
        function selectRole(role) {
            currentRole = role;
            const roleName = role.charAt(0).toUpperCase() + role.slice(1);
            document.getElementById('selectedRole').textContent = roleName;
            document.getElementById('loginRole').textContent = roleName;
            
            // Show/hide owner-specific fields
            if (role === 'owner') {
                document.getElementById('ownerFields').style.display = 'block';
            } else {
                document.getElementById('ownerFields').style.display = 'none';
            }
            
            showSignup();
        }
        
        function showSignup() {
            document.querySelectorAll('.auth-step').forEach(step => step.classList.remove('active'));
            document.getElementById('signupForm').classList.add('active');
        }
        
        function showLogin() {
            document.querySelectorAll('.auth-step').forEach(step => step.classList.remove('active'));
            document.getElementById('loginForm').classList.add('active');
        }
        
        function backToRoles() {
            resetAuth();
        }
        
        async function handleSignup(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            
            // Validate passwords match
            if (data.password !== data.confirm_password) {
                showNotification('Passwords do not match!', 'error');
                return;
            }
            
            // Remove confirm_password from data
            delete data.confirm_password;
            
            // Add role
            data.role = currentRole;
            
            showLoading();
            
            try {
                const response = await fetch('/signup', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification(result.message || 'Account created successfully!', 'success');
                    closeAuth();
                    
                    setTimeout(() => {
                        redirectToDashboard(result.role);
                    }, 1000);
                } else {
                    showNotification(result.error || 'Signup failed. Please try again.', 'error');
                }
            } catch (error) {
                console.error('Signup error:', error);
                showNotification('An error occurred. Please try again.', 'error');
            } finally {
                hideLoading();
            }
        }
        
        async function handleLogin(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            
            showLoading();
            
            try {
                const response = await fetch('/login', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification(result.message || 'Login successful!', 'success');
                    closeAuth();
                    
                    setTimeout(() => {
                        redirectToDashboard(result.role);
                    }, 1000);
                } else {
                    showNotification(result.error || 'Invalid credentials', 'error');
                }
            } catch (error) {
                console.error('Login error:', error);
                showNotification('An error occurred. Please try again.', 'error');
            } finally {
                hideLoading();
            }
        }
        
        function redirectToDashboard(role) {
            window.location.href = `/${role}/dashboard`;
        }
        
        function showLoading() {
            document.getElementById('loadingSpinner').style.display = 'flex';
        }
        
        function hideLoading() {
            document.getElementById('loadingSpinner').style.display = 'none';
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 25px;
                background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
                color: white;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                z-index: 10000;
                animation: slideIn 0.3s ease;
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // Add CSS animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
